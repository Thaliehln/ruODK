---
title: "Setup"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{setup}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}  
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(ruODK)
```

# Configure ruODK
Currently, ODK Central supports BasicAuth (username and password) and 
SessionAuth. `ruODK` supports only BasicAuth.

Each ruODK function accepts the server base URL, username, and password, with
defaults looking for R environment variables `ODKC_URL`, `ODKC_UN`, and `ODKC_PW`
through the helper functions `get_default_{url, un, pw}()`.

There are three ways of providing those settings to each function call.

## Per function call
We can supply those credentials to each `ruODK` function call, but that's
cumbersome and not securely reproducible (the command would include the 
sensitive  credentials).

```{r, eval=FALSE}
ruODK::project_list(url="https://my-odkc.com", un="me@mail.com", pw=".......")
```

An example use case are the `ruODK` tests, which require settings different from
the settings used during development and in the vignettes.

## Per session
`ruODK` provides helpers for settings, `ru_setup()` to set and `ru_settings()` 
to get settings.
While normal users of `ruODK` will only need a default url, username, and 
password, contributors to `ruODK` can include optional test server settings.

```{r ru_setup}
# ruODK user
ruODK::ru_setup(
  url = "https://odkcentral.dbca.wa.gov.au", 
  un = "me@email.com", 
  pw = "..."
)

# ruODK contributor
ruODK::ru_setup(
  url = "https://odkcentral.dbca.wa.gov.au", 
  un = "me@email.com", 
  pw = "...",
  test_url = "https://sandbox.central.opendatakit.org", 
  test_un = "me@email.com", 
  test_pw = "...",
  test_pid = 14,
  test_fid = "build_Flora-Quadrat-0-2_1558575936"
)

# Review settings
ruODK::ru_settings()
```

Now we can call `ruODK` functions without settings, and let `ruODK` fall back
to the default credentials:

```{r, eval=FALSE}
ruODK::project_list()
```


## Per machine
Let's make those settings a permanent default.

A convenient way to have often used environment variables available is to add
them to `~/.Renviron` using `usethis::edit_r_environ(scope = "user")`.
This loads them freshly into a new session, eliminating the need to run 
`ru_setup()`. Note that the environment variables can be cleared or overwritten 
through calling `ru_setup()` or `Sys.setenv()`.

```{r open_renviron, eval=FALSE}
usethis::edit_r_environ(scope = "user")
```


```{r renviron, eval=FALSE}
ODKC_URL="https://odkcentral.dbca.wa.gov.au"
ODKC_UN="me@email.com"
ODKC_PW="..."
ODKC_TEST_URL="https://sandbox.central.opendatakit.org"
ODKC_TEST_UN="me@email.com"
ODKC_TEST_PW="..."
ODKC_TEST_PID=14
ODKC_TEST_FID="build_Flora-Quadrat-0-2_1558575936"
```


As an alternative to setting environment variables through `~/.Renviron`, 
you can set them through `Sys.setenv()`:

```{r setenv}
Sys.setenv(ODKC_URL="https://odkcentral.dbca.wa.gov.au")
Sys.setenv(ODKC_UN="me@mail.com")
Sys.setenv(ODKC_PW="...")
Sys.setenv(ODKC_TEST_URL="https://sandbox.central.opendatakit.org")
Sys.setenv(ODKC_TEST_UN="me@mail.com")
Sys.setenv(ODKC_TEST_PW="...")
Sys.setenv(ODKC_TEST_PID=14)
Sys.setenv(ODKC_TEST_FID="build_Flora-Quadrat-0-2_1558575936")

# Review settings
ruODK::ru_settings()
```