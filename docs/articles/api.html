<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Accessing the RESTful API • ruODK</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Accessing the RESTful API">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ruODK</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/api.html">Accessing the RESTful API</a>
    </li>
    <li>
      <a href="../articles/odata.html">Accessing the OData API</a>
    </li>
    <li>
      <a href="../articles/setup.html">Setup</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dbca-wa/ruODK">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="api_files/htmlwidgets-1.3/htmlwidgets.js"></script><script src="api_files/jquery-1.12.4/jquery.min.js"></script><link href="api_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="api_files/datatables-binding-0.7/datatables.js"></script><link href="api_files/dt-core-1.10.16/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="api_files/dt-core-1.10.16/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="api_files/dt-core-1.10.16/js/jquery.dataTables.min.js"></script><link href="api_files/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet">
<script src="api_files/crosstalk-1.0.0/js/crosstalk.min.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Accessing the RESTful API</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dbca-wa/ruODK/blob/master/vignettes/api.Rmd"><code>vignettes/api.Rmd</code></a></small>
      <div class="hidden name"><code>api.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(magrittr)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ruODK)</a></code></pre></div>
<div id="scope" class="section level1">
<h1 class="hasAnchor">
<a href="#scope" class="anchor"></a>Scope</h1>
<p>This vignette provides a walk-through of the “getting data out” functions of the RESTful API endpoints which list and view details.</p>
<p><code>ruODK</code> users would mix and match parts of the demonstrated workflows to build their own data pipelines, e.g.:</p>
<ul>
<li>to build a quick analysis from all data, freshly downloaded from a smaller project, or</li>
<li>to build an interactive ETL pipeline to selectively download only new submissions for further processing and upload into downstream data warehouses.</li>
</ul>
<div id="three-ways-to-happiness" class="section level2">
<h2 class="hasAnchor">
<a href="#three-ways-to-happiness" class="anchor"></a>Three ways to happiness</h2>
<p>ODK Central offers no less than three different ways to access data:</p>
<ul>
<li>viewing ODK Central data in MS PowerBI, MS Excel, Tableau, or <code>ruODK</code> through the OData service endpoints, or</li>
<li>downloading all submissions including attachments as one (possibly gigantic) zip archive either through the “Export Submissions” button in the ODK Central form submissions page or through <code>ruODK</code>,</li>
<li>viewing ODK Central data through <code>ruODK</code>’s RESTful API functions.</li>
</ul>
<p>While the <code><a href="../articles/odata.html">vignette("odata", package="ruODK")</a></code> (online <a href="https://dbca-wa.github.io/ruODK/articles/odata.html">here</a>) illustrates the first option, this vignette demonstrates the remaining two.</p>
<p>Not implemented (yet) are the “managing ODK Central” functions which create, update, and delete projects, forms, users, roles, and permissions. We haven’t yet found a strong use case to automate those functions - ODK Central (driven by humans) does those jobs beautifully on an expected scale.</p>
</div>
</div>
<div id="setup-ruodk" class="section level1">
<h1 class="hasAnchor">
<a href="#setup-ruodk" class="anchor"></a>Setup ruODK</h1>
<p>See <a href="https://dbca-wa.github.io/ruODK/articles/setup.html"><code>vignette("Setup", package = "ruODK")</code></a> for detailed options to configure <code>ruODK</code>.</p>
</div>
<div id="projects" class="section level1">
<h1 class="hasAnchor">
<a href="#projects" class="anchor"></a>Projects</h1>
<p>List projects. We see the project ID, a name, the number of forms and app users, dates of last form submissions plus project management timestamps (created, updated).</p>
<p>The important bit here is the project ID.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">p &lt;-<span class="st"> </span>ruODK<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ruODK/man/project_list.html">project_list</a></span>()</a>
<a class="sourceLine" id="cb2-2" title="2">p <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(.)</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">id</th>
<th align="left">name</th>
<th align="right">forms</th>
<th align="right">app_users</th>
<th align="left">last_submission</th>
<th align="left">created_at</th>
<th align="left">updated_at</th>
<th align="left">archived</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">DBCA</td>
<td align="right">9</td>
<td align="right">1</td>
<td align="left">2019-08-16 09:07:01</td>
<td align="left">2019-06-05 09:12:44</td>
<td align="left">2019-07-23 01:00:08</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="left">Flora</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">2019-08-12 04:47:05</td>
<td align="left">2019-06-06 03:24:31</td>
<td align="left">2019-06-06 03:24:42</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">Spotlighting (test)</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="left">2019-06-26 07:12:25</td>
<td align="left">2019-06-06 03:24:15</td>
<td align="left">2019-08-20 09:27:25</td>
<td align="left">FALSE</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">DBCA</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">NA</td>
<td align="left">2019-06-27 02:54:30</td>
<td align="left">2019-07-22 02:44:23</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<p>Inspect a project using its ID. We receive a tibble with exactly one row, all the columns of <code><a href="../reference/project_list.html">ruODK::project_list</a></code> plus a column <code>verbs</code>, which contains all available API actions for a project.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">pd &lt;-<span class="st"> </span>ruODK<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ruODK/man/project_detail.html">project_detail</a></span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb3-2" title="2">pd <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span><span class="st">"verbs"</span>) <span class="op">%&gt;%</span><span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(.)</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">id</th>
<th align="left">name</th>
<th align="right">forms</th>
<th align="right">app_users</th>
<th align="left">last_submission</th>
<th align="left">created_at</th>
<th align="left">updated_at</th>
<th align="left">archived</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">1</td>
<td align="left">DBCA</td>
<td align="right">9</td>
<td align="right">1</td>
<td align="left">2019-08-16T09:07:01.674Z</td>
<td align="left">2019-06-05T09:12:44.272Z</td>
<td align="left">2019-07-23T01:00:08.564Z</td>
<td align="left">FALSE</td>
</tr></tbody>
</table>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">pd<span class="op">$</span>verbs[[<span class="dv">1</span>]] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(.)</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="co">#&gt;  [1] "backup.create"            "backup.terminate"        </span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">#&gt;  [3] "config.read"              "field_key.create"        </span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">#&gt;  [5] "field_key.delete"         "field_key.list"          </span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">#&gt;  [7] "form.create"              "form.delete"             </span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">#&gt;  [9] "form.list"                "form.read"               </span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co">#&gt; [11] "form.update"              "project.create"          </span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co">#&gt; [13] "project.delete"           "project.read"            </span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">#&gt; [15] "project.update"           "session.end"             </span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="co">#&gt; [17] "submission.create"        "submission.read"         </span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co">#&gt; [19] "submission.list"          "user.create"             </span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co">#&gt; [21] "user.list"                "user.password.invalidate"</span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co">#&gt; [23] "user.read"                "user.update"             </span></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="co">#&gt; [25] "submission.update"        "role.create"             </span></a>
<a class="sourceLine" id="cb4-15" title="15"><span class="co">#&gt; [27] "role.update"              "role.delete"             </span></a>
<a class="sourceLine" id="cb4-16" title="16"><span class="co">#&gt; [29] "assignment.list"          "assignment.create"       </span></a>
<a class="sourceLine" id="cb4-17" title="17"><span class="co">#&gt; [31] "assignment.delete"        "user.delete"             </span></a>
<a class="sourceLine" id="cb4-18" title="18"><span class="co">#&gt; [33] "audit.read"</span></a></code></pre></div>
<p>Nothing apart from the verbs is new compared to the data returned by <code><a href="../reference/project_list.html">ruODK::project_list</a></code>.</p>
<p>To learn more about the functionality behind the verbs, refer to the interactive <a href="https://odkcentral.docs.apiary.io/#reference/project-management">ODK Central API documentation</a>.</p>
<p>To retrieve data from ODK Central, the functions shown below will suffice.</p>
</div>
<div id="forms" class="section level1">
<h1 class="hasAnchor">
<a href="#forms" class="anchor"></a>Forms</h1>
<div id="list-forms-for-a-project" class="section level2">
<h2 class="hasAnchor">
<a href="#list-forms-for-a-project" class="anchor"></a>List forms for a project</h2>
<p>To download form submissions, we need to know project ID and form ID.</p>
<p>There are several ways of retrieving the form ID:</p>
<ul>
<li>Browsing forms in the ODK Central’s project overviews,</li>
<li>Stealing the form ID from the OData service endpoint URL as shown on ODK Central’s form submission page,</li>
<li>Listing form metadata for a given project ID with <code><a href="../reference/form_list.html">ruODK::form_list()</a></code>.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">forms &lt;-<span class="st"> </span>ruODK<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ruODK/man/form_list.html">form_list</a></span>(<span class="dv">1</span>) </a>
<a class="sourceLine" id="cb5-2" title="2">forms <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(.)</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">name</th>
<th align="left">fid</th>
<th align="left">version</th>
<th align="left">state</th>
<th align="left">submissions</th>
<th align="left">created_at</th>
<th align="right">created_by_id</th>
<th align="left">created_by</th>
<th align="left">updated_at</th>
<th align="left">last_submission</th>
<th align="left">hash</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Flora Quadrat 0.4</td>
<td align="left">build_Flora-Quadrat-0-4_1564384341</td>
<td align="left"></td>
<td align="left">open</td>
<td align="left">0</td>
<td align="left">2019-07-29 07:13:48</td>
<td align="right">5</td>
<td align="left">Florian Mayer</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">1bb959d541ac6990e3f74893e38c855b</td>
</tr>
<tr class="even">
<td align="left">Marine Wildlife Incident 0.6</td>
<td align="left">build_Marine-Wildlife-Incident-0-6_1559789189</td>
<td align="left"></td>
<td align="left">open</td>
<td align="left">4</td>
<td align="left">2019-06-06 03:29:04</td>
<td align="right">5</td>
<td align="left">Florian Mayer</td>
<td align="left">NA</td>
<td align="left">2019-06-28 08:36:08</td>
<td align="left">ef79df7abb830de618d82765c36c2f59</td>
</tr>
<tr class="odd">
<td align="left">Predator or Disturbance 1.1</td>
<td align="left">build_Predator-or-Disturbance-1-1_1559789410</td>
<td align="left"></td>
<td align="left">open</td>
<td align="left">7</td>
<td align="left">2019-06-06 03:31:25</td>
<td align="right">5</td>
<td align="left">Florian Mayer</td>
<td align="left">NA</td>
<td align="left">2019-08-16 09:07:01</td>
<td align="left">9c70919ed211e2492ff1dda7a6c7c564</td>
</tr>
<tr class="even">
<td align="left">Site Visit End 0.2</td>
<td align="left">build_Site-Visit-End-0-2_1559789512</td>
<td align="left"></td>
<td align="left">open</td>
<td align="left">0</td>
<td align="left">2019-06-06 03:31:13</td>
<td align="right">5</td>
<td align="left">Florian Mayer</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">7b4d658b314cd1f0aef8c056c8d3009b</td>
</tr>
<tr class="odd">
<td align="left">Site Visit Start 0.3</td>
<td align="left">build_Site-Visit-Start-0-3_1559789550</td>
<td align="left"></td>
<td align="left">open</td>
<td align="left">0</td>
<td align="left">2019-06-06 03:31:02</td>
<td align="right">5</td>
<td align="left">Florian Mayer</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">64e8fabc98ad20cd1eb1de62ac1d35c3</td>
</tr>
<tr class="even">
<td align="left">Track Tally 0.5</td>
<td align="left">build_Track-Tally-0-5_1564032721</td>
<td align="left"></td>
<td align="left">closing</td>
<td align="left">2</td>
<td align="left">2019-07-25 05:32:44</td>
<td align="right">5</td>
<td align="left">Florian Mayer</td>
<td align="left">2019-07-29 07:57:44</td>
<td align="left">2019-07-29 01:46:36</td>
<td align="left">2d521c5b75c07238a5c55010efecf21b</td>
</tr>
<tr class="odd">
<td align="left">Turtle Sighting 0.1</td>
<td align="left">build_Turtle-Sighting-0-1_1559790020</td>
<td align="left"></td>
<td align="left">open</td>
<td align="left">90</td>
<td align="left">2019-06-06 03:29:16</td>
<td align="right">5</td>
<td align="left">Florian Mayer</td>
<td align="left">NA</td>
<td align="left">2019-07-22 01:09:38</td>
<td align="left">dc5906a4a18c33ff0cfeee419b0ce00e</td>
</tr>
<tr class="even">
<td align="left">Turtle Track or Nest 1.0</td>
<td align="left">build_Turtle-Track-or-Nest-1-0_1559789920</td>
<td align="left"></td>
<td align="left">open</td>
<td align="left">2</td>
<td align="left">2019-06-06 03:30:36</td>
<td align="right">5</td>
<td align="left">Florian Mayer</td>
<td align="left">NA</td>
<td align="left">2019-06-27 03:16:50</td>
<td align="left">b52193af35826ff9da3678cc22469535</td>
</tr>
<tr class="odd">
<td align="left">Turtle Track Tally 0.6</td>
<td align="left">build_Turtle-Track-Tally-0-6_1564387009</td>
<td align="left"></td>
<td align="left">open</td>
<td align="left">2</td>
<td align="left">2019-07-29 07:57:36</td>
<td align="right">5</td>
<td align="left">Florian Mayer</td>
<td align="left">NA</td>
<td align="left">2019-08-01 01:45:12</td>
<td align="left">c293c4cc528738cdfb596e3b9732c66f</td>
</tr>
</tbody>
</table>
<p>Further to the metadata shown here, a column <code>xml</code> contains the entire XForms definition (originally XML) as nested list.</p>
<p>If the original XML is needed rather than the R equivalent (nested list), we can use <code><a href="../reference/form_xml.html">ruODK::form_xml</a></code> with parameter <code>parse=FALSE</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">form_xml &lt;-<span class="st"> </span>ruODK<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ruODK/man/form_xml.html">form_xml</a></span>(<span class="dv">1</span>, forms<span class="op">$</span>fid[[<span class="dv">1</span>]], <span class="dt">parse=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb6-2" title="2">form_xml</a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co">#&gt; {xml_document}</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co">#&gt; &lt;html xmlns="http://www.w3.org/2002/xforms" xmlns:h="http://www.w3.org/1999/xhtml" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa"&gt;</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co">#&gt; [1] &lt;h:head&gt;\n  &lt;h:title&gt;Flora Quadrat 0.4&lt;/h:title&gt;\n  &lt;model&gt;\n    &lt;in ...</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="co">#&gt; [2] &lt;h:body&gt;\n  &lt;group ref="/data/location" appearance="field-list"&gt;\n   ...</span></a></code></pre></div>
</div>
<div id="show-details-of-one-form" class="section level2">
<h2 class="hasAnchor">
<a href="#show-details-of-one-form" class="anchor"></a>Show details of one form</h2>
<p>The details of a form are exactly the same as the output of <code><a href="../reference/form_list.html">ruODK::form_list()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">form &lt;-<span class="st"> </span>ruODK<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ruODK/man/form_detail.html">form_detail</a></span>(<span class="dv">1</span>, forms<span class="op">$</span>fid[[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb7-2" title="2">form <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(.)</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">name</th>
<th align="left">fid</th>
<th align="left">version</th>
<th align="left">state</th>
<th align="right">submissions</th>
<th align="left">created_at</th>
<th align="right">created_by_id</th>
<th align="left">created_by</th>
<th align="left">updated_at</th>
<th align="left">last_submission</th>
<th align="left">hash</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Flora Quadrat 0.4</td>
<td align="left">build_Flora-Quadrat-0-4_1564384341</td>
<td align="left"></td>
<td align="left">open</td>
<td align="right">0</td>
<td align="left">2019-07-29T07:13:48.415Z</td>
<td align="right">5</td>
<td align="left">Florian Mayer</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">1bb959d541ac6990e3f74893e38c855b</td>
</tr></tbody>
</table>
</div>
<div id="inspect-form-schema" class="section level2">
<h2 class="hasAnchor">
<a href="#inspect-form-schema" class="anchor"></a>Inspect form schema</h2>
<p>The nested list of lists returned by <code>form_schema</code> is the cleanest representation of the Xform definition available in R. See the <a href="https://odkcentral.docs.apiary.io/#reference/forms-and-submissions/'-individual-form/retrieving-form-schema-json">ODK Central API docs</a> and the examples of <code>??ruODK::form_schema()</code> for more detail.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">fs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/form_schema.html">form_schema</a></span>(<span class="dv">1</span>, forms<span class="op">$</span>fid[[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="co"># listviewer::jsonedit(fs)</span></a></code></pre></div>
<p>Namely, the form schema tells us about form field data types (dates, geopoints, binary attachments) and repeating groups. We need this knowledge to parse the submission data into tidy tibbles later.</p>
</div>
</div>
<div id="submissions" class="section level1">
<h1 class="hasAnchor">
<a href="#submissions" class="anchor"></a>Submissions</h1>
<p>We are getting closer to the actual data! This section shows two of the options for data access: dump all submissions, or extract a subset.</p>
<div id="get-all-submissions-for-one-form" class="section level2">
<h2 class="hasAnchor">
<a href="#get-all-submissions-for-one-form" class="anchor"></a>Get all submissions for one form</h2>
<p>Smaller datasets lend themselves to be exported in one go. ODK Central offers one giant zip file containing all submissions, any repeating groups, and any attachments both on the form submission page, and as API endpoint which is provided as <code><a href="../reference/submission_export.html">ruODK::submission_export()</a></code>.</p>
<p>The default behaviour of <code><a href="../reference/submission_export.html">ruODK::submission_export()</a></code> is to write the zip file to the project root (<code><a href="https://rdrr.io/pkg/here/man/here.html">here::here()</a></code>), and to overwrite existing previous downloads. See <code>?ruODK::submission_export()</code> for alternative download and retention options.</p>
<p>In the following chuck, we illustrate common tasks:</p>
<ul>
<li>Download the zip file.</li>
<li>Unpack the zip file.</li>
<li>Join repeating form group data <code>data_taxon</code> to main data <code>data_quadrat</code> to annotate <code>data_taxon</code> with data from <code>data_quadrat</code>.</li>
<li>Sanitise the column names.</li>
<li>Prepend all attachment filenames (e.g. <code>data_quadrat$location_quadrat_photo</code>, <code>data_taxon$photo_in_situ</code>) with <code>media/</code>.</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">t &lt;-<span class="st"> </span>fs<span class="op">::</span><span class="kw"><a href="http://fs.r-lib.org/reference/create.html">dir_create</a></span>(<span class="st">"api"</span>)</a>
<a class="sourceLine" id="cb9-2" title="2"></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="co"># Predict filenames (with knowledge of form)</span></a>
<a class="sourceLine" id="cb9-4" title="4">fid &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_FID"</span>)</a>
<a class="sourceLine" id="cb9-5" title="5">fid_csv &lt;-<span class="st"> </span>fs<span class="op">::</span><span class="kw"><a href="http://fs.r-lib.org/reference/path.html">path</a></span>(t, glue<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span>(<span class="st">"{fid}.csv"</span>))</a>
<a class="sourceLine" id="cb9-6" title="6">fid_csv_tae &lt;-<span class="st"> </span>fs<span class="op">::</span><span class="kw"><a href="http://fs.r-lib.org/reference/path.html">path</a></span>(t, glue<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span>(<span class="st">"{fid}-taxon_encounter.csv"</span>))</a>
<a class="sourceLine" id="cb9-7" title="7"></a>
<a class="sourceLine" id="cb9-8" title="8"><span class="co"># Download the zip file</span></a>
<a class="sourceLine" id="cb9-9" title="9">se &lt;-<span class="st"> </span>ruODK<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ruODK/man/submission_export.html">submission_export</a></span>(</a>
<a class="sourceLine" id="cb9-10" title="10">  <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_PID"</span>),</a>
<a class="sourceLine" id="cb9-11" title="11">  <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_FID"</span>),</a>
<a class="sourceLine" id="cb9-12" title="12">  <span class="dt">local_dir =</span> t,</a>
<a class="sourceLine" id="cb9-13" title="13">  <span class="dt">overwrite =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb9-14" title="14">  <span class="dt">verbose =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb9-15" title="15">  <span class="dt">url =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_URL"</span>),</a>
<a class="sourceLine" id="cb9-16" title="16">  <span class="dt">un =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_UN"</span>),</a>
<a class="sourceLine" id="cb9-17" title="17">  <span class="dt">pw =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_PW"</span>)</a>
<a class="sourceLine" id="cb9-18" title="18">)</a>
<a class="sourceLine" id="cb9-19" title="19"><span class="co">#&gt; Keeping previous download: api/build_Flora-Quadrat-0-2_1558575936.zip</span></a>
<a class="sourceLine" id="cb9-20" title="20"></a>
<a class="sourceLine" id="cb9-21" title="21"><span class="co"># Unpack the zip file</span></a>
<a class="sourceLine" id="cb9-22" title="22">f &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/utils/unzip.html">unzip</a></span>(se, <span class="dt">exdir =</span> t)</a>
<a class="sourceLine" id="cb9-23" title="23">fs<span class="op">::</span><span class="kw"><a href="http://fs.r-lib.org/reference/dir_ls.html">dir_ls</a></span>(t)</a>
<a class="sourceLine" id="cb9-24" title="24"><span class="co">#&gt; api/build_Flora-Quadrat-0-2_1558575936-taxon_encounter.csv</span></a>
<a class="sourceLine" id="cb9-25" title="25"><span class="co">#&gt; api/build_Flora-Quadrat-0-2_1558575936.csv</span></a>
<a class="sourceLine" id="cb9-26" title="26"><span class="co">#&gt; api/build_Flora-Quadrat-0-2_1558575936.zip</span></a>
<a class="sourceLine" id="cb9-27" title="27"><span class="co">#&gt; api/c0f9ce58-4388-4e7b-98d7-feac459d2e12</span></a>
<a class="sourceLine" id="cb9-28" title="28"><span class="co">#&gt; api/e0375332-0bb5-4175-a498-549bb33420e4</span></a>
<a class="sourceLine" id="cb9-29" title="29"><span class="co">#&gt; api/media</span></a>
<a class="sourceLine" id="cb9-30" title="30"></a>
<a class="sourceLine" id="cb9-31" title="31"><span class="co"># Read the CSV files</span></a>
<a class="sourceLine" id="cb9-32" title="32">data_quadrat_raw &lt;-<span class="st"> </span>fid_csv <span class="op">%&gt;%</span><span class="st"> </span>readr<span class="op">::</span><span class="kw"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span>()</a>
<a class="sourceLine" id="cb9-33" title="33"><span class="co">#&gt; Parsed with column specification:</span></a>
<a class="sourceLine" id="cb9-34" title="34"><span class="co">#&gt; cols(</span></a>
<a class="sourceLine" id="cb9-35" title="35"><span class="co">#&gt;   .default = col_double(),</span></a>
<a class="sourceLine" id="cb9-36" title="36"><span class="co">#&gt;   SubmissionDate = col_datetime(format = ""),</span></a>
<a class="sourceLine" id="cb9-37" title="37"><span class="co">#&gt;   `meta-instanceID` = col_character(),</span></a>
<a class="sourceLine" id="cb9-38" title="38"><span class="co">#&gt;   encounter_start_datetime = col_datetime(format = ""),</span></a>
<a class="sourceLine" id="cb9-39" title="39"><span class="co">#&gt;   reporter = col_character(),</span></a>
<a class="sourceLine" id="cb9-40" title="40"><span class="co">#&gt;   device_id = col_character(),</span></a>
<a class="sourceLine" id="cb9-41" title="41"><span class="co">#&gt;   `location-area_name` = col_character(),</span></a>
<a class="sourceLine" id="cb9-42" title="42"><span class="co">#&gt;   `location-quadrat_photo` = col_character(),</span></a>
<a class="sourceLine" id="cb9-43" title="43"><span class="co">#&gt;   `habitat-morphological_type` = col_character(),</span></a>
<a class="sourceLine" id="cb9-44" title="44"><span class="co">#&gt;   `habitat-morphological_type_photo` = col_character(),</span></a>
<a class="sourceLine" id="cb9-45" title="45"><span class="co">#&gt;   `vegetation_structure-vegclass_placeholder` = col_character(),</span></a>
<a class="sourceLine" id="cb9-46" title="46"><span class="co">#&gt;   `perimeter-mudmap_photo` = col_character(),</span></a>
<a class="sourceLine" id="cb9-47" title="47"><span class="co">#&gt;   encounter_end_datetime = col_datetime(format = ""),</span></a>
<a class="sourceLine" id="cb9-48" title="48"><span class="co">#&gt;   KEY = col_character(),</span></a>
<a class="sourceLine" id="cb9-49" title="49"><span class="co">#&gt;   SubmitterName = col_character(),</span></a>
<a class="sourceLine" id="cb9-50" title="50"><span class="co">#&gt;   Status = col_character()</span></a>
<a class="sourceLine" id="cb9-51" title="51"><span class="co">#&gt; )</span></a>
<a class="sourceLine" id="cb9-52" title="52"><span class="co">#&gt; See spec(...) for full column specifications.</span></a>
<a class="sourceLine" id="cb9-53" title="53"><span class="co">#&gt; Warning: 2 parsing failures.</span></a>
<a class="sourceLine" id="cb9-54" title="54"><span class="co">#&gt; row col   expected     actual                                         file</span></a>
<a class="sourceLine" id="cb9-55" title="55"><span class="co">#&gt;   1  -- 32 columns 31 columns 'api/build_Flora-Quadrat-0-2_1558575936.csv'</span></a>
<a class="sourceLine" id="cb9-56" title="56"><span class="co">#&gt;   2  -- 32 columns 31 columns 'api/build_Flora-Quadrat-0-2_1558575936.csv'</span></a>
<a class="sourceLine" id="cb9-57" title="57">data_taxon_raw &lt;-<span class="st"> </span>fid_csv_tae <span class="op">%&gt;%</span><span class="st"> </span>readr<span class="op">::</span><span class="kw"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span>()</a>
<a class="sourceLine" id="cb9-58" title="58"><span class="co">#&gt; Parsed with column specification:</span></a>
<a class="sourceLine" id="cb9-59" title="59"><span class="co">#&gt; cols(</span></a>
<a class="sourceLine" id="cb9-60" title="60"><span class="co">#&gt;   canonical_name = col_character(),</span></a>
<a class="sourceLine" id="cb9-61" title="61"><span class="co">#&gt;   photo_in_situ = col_character(),</span></a>
<a class="sourceLine" id="cb9-62" title="62"><span class="co">#&gt;   `taxon_encounter_location-Latitude` = col_double(),</span></a>
<a class="sourceLine" id="cb9-63" title="63"><span class="co">#&gt;   `taxon_encounter_location-Longitude` = col_double(),</span></a>
<a class="sourceLine" id="cb9-64" title="64"><span class="co">#&gt;   `taxon_encounter_location-Altitude` = col_double(),</span></a>
<a class="sourceLine" id="cb9-65" title="65"><span class="co">#&gt;   `taxon_encounter_location-Accuracy` = col_double(),</span></a>
<a class="sourceLine" id="cb9-66" title="66"><span class="co">#&gt;   life_form = col_character(),</span></a>
<a class="sourceLine" id="cb9-67" title="67"><span class="co">#&gt;   voucher_specimen_barcode = col_double(),</span></a>
<a class="sourceLine" id="cb9-68" title="68"><span class="co">#&gt;   PARENT_KEY = col_character(),</span></a>
<a class="sourceLine" id="cb9-69" title="69"><span class="co">#&gt;   KEY = col_character()</span></a>
<a class="sourceLine" id="cb9-70" title="70"><span class="co">#&gt; )</span></a>
<a class="sourceLine" id="cb9-71" title="71"></a>
<a class="sourceLine" id="cb9-72" title="72"><span class="co"># Sanitize column names</span></a>
<a class="sourceLine" id="cb9-73" title="73">add_dettol &lt;-<span class="st"> </span>. <span class="op">%&gt;%</span><span class="st"> </span>stringr<span class="op">::</span><span class="kw"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span>(., <span class="st">"-"</span>, <span class="st">"_"</span>)</a>
<a class="sourceLine" id="cb9-74" title="74"><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(data_quadrat_raw) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(data_quadrat_raw) <span class="op">%&gt;%</span><span class="st"> </span>add_dettol</a>
<a class="sourceLine" id="cb9-75" title="75"><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(data_taxon_raw) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(data_taxon_raw) <span class="op">%&gt;%</span><span class="st"> </span>add_dettol</a>
<a class="sourceLine" id="cb9-76" title="76"></a>
<a class="sourceLine" id="cb9-77" title="77"><span class="co"># Prepend attachments with media/ to turn into relative file paths</span></a>
<a class="sourceLine" id="cb9-78" title="78">data_quadrat &lt;-<span class="st"> </span>data_quadrat_raw <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-79" title="79"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(</a>
<a class="sourceLine" id="cb9-80" title="80">    <span class="dt">location_quadrat_photo =</span> glue<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span>(<span class="st">"media/{location_quadrat_photo}"</span>),</a>
<a class="sourceLine" id="cb9-81" title="81">    <span class="dt">habitat_morphological_type_photo =</span> glue<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span>(<span class="st">"media/{habitat_morphological_type_photo}"</span>),</a>
<a class="sourceLine" id="cb9-82" title="82">    <span class="dt">perimeter_mudmap_photo =</span> glue<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span>(<span class="st">"media/{perimeter_mudmap_photo}"</span>)</a>
<a class="sourceLine" id="cb9-83" title="83">  )</a>
<a class="sourceLine" id="cb9-84" title="84">DT<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span>(data_quadrat)</a></code></pre></div>
<div id="htmlwidget-ce404d18a7bc879cd585" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ce404d18a7bc879cd585">{"x":{"filter":"none","data":[["1","2"],["2019-05-23T03:12:16Z","2019-05-23T03:07:34Z"],["uuid:c0f9ce58-4388-4e7b-98d7-feac459d2e12","uuid:e0375332-0bb5-4175-a498-549bb33420e4"],["2019-05-23T02:46:04Z","2019-05-23T02:58:34Z"],["Florian Mayer","Florian Mayer"],["ccb596b33cd13298","351848090572014"],["Kens1","Kens02"],["media/1558579592153.jpg","media/1558580334821.jpg"],[-31.9961844,-31.99620765],[115.8840312,115.88430933],[0,-21],[41.909,12.864],["open-depression","flat"],["media/1558579731266.jpg","media/1558580394989.jpg"],["Lanscaped native shrubs over red gravel","Planter box over concrete pavers"],[-31.9961229,-31.99620102],[115.883982,115.88428661],[0,-22],[40.977,12.864],[-31.9966621,-31.99619855],[115.884307,115.88427853],[0,-22],[60,15.008],[-31.9961278,-31.99617953],[115.8840645,115.88427163],[0,-26],[72.9,9.648001],["media/1558580082333.jpg","media/1558580571494.jpg"],["2019-05-23T02:57:17Z","2019-05-23T03:05:48Z"],["uuid:c0f9ce58-4388-4e7b-98d7-feac459d2e12","uuid:e0375332-0bb5-4175-a498-549bb33420e4"],[228,228],["manjimup","manjimup"],[null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>SubmissionDate<\/th>\n      <th>meta_instanceID<\/th>\n      <th>encounter_start_datetime<\/th>\n      <th>reporter<\/th>\n      <th>device_id<\/th>\n      <th>location_area_name<\/th>\n      <th>location_quadrat_photo<\/th>\n      <th>location_corner1_Latitude<\/th>\n      <th>location_corner1_Longitude<\/th>\n      <th>location_corner1_Altitude<\/th>\n      <th>location_corner1_Accuracy<\/th>\n      <th>habitat_morphological_type<\/th>\n      <th>habitat_morphological_type_photo<\/th>\n      <th>vegetation_structure_vegclass_placeholder<\/th>\n      <th>perimeter_corner2_Latitude<\/th>\n      <th>perimeter_corner2_Longitude<\/th>\n      <th>perimeter_corner2_Altitude<\/th>\n      <th>perimeter_corner2_Accuracy<\/th>\n      <th>perimeter_corner3_Latitude<\/th>\n      <th>perimeter_corner3_Longitude<\/th>\n      <th>perimeter_corner3_Altitude<\/th>\n      <th>perimeter_corner3_Accuracy<\/th>\n      <th>perimeter_corner4_Latitude<\/th>\n      <th>perimeter_corner4_Longitude<\/th>\n      <th>perimeter_corner4_Altitude<\/th>\n      <th>perimeter_corner4_Accuracy<\/th>\n      <th>perimeter_mudmap_photo<\/th>\n      <th>encounter_end_datetime<\/th>\n      <th>KEY<\/th>\n      <th>SubmitterID<\/th>\n      <th>SubmitterName<\/th>\n      <th>Status<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[8,9,10,11,15,16,17,18,19,20,21,22,23,24,25,26,30]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="co"># Further: create map with popups, see vignette "odata"</span></a>
<a class="sourceLine" id="cb10-2" title="2"></a>
<a class="sourceLine" id="cb10-3" title="3">data_taxon &lt;-<span class="st"> </span>data_taxon_raw <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(</a>
<a class="sourceLine" id="cb10-5" title="5">    <span class="dt">photo_in_situ =</span> glue<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/glue/man/glue.html">glue</a></span>(<span class="st">"media/{photo_in_situ}"</span>)</a>
<a class="sourceLine" id="cb10-6" title="6">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(</a>
<a class="sourceLine" id="cb10-8" title="8">    data_quadrat,</a>
<a class="sourceLine" id="cb10-9" title="9">    <span class="dt">by =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"PARENT_KEY"</span> =<span class="st"> "meta_instanceID"</span>)</a>
<a class="sourceLine" id="cb10-10" title="10">  )</a>
<a class="sourceLine" id="cb10-11" title="11">DT<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span>(data_taxon)</a></code></pre></div>
<div id="htmlwidget-13c73f8b45317abdb9f3" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-13c73f8b45317abdb9f3">{"x":{"filter":"none","data":[["1","2","3","4"],["Grevillea","Dontknowsiana sp.","Species 1","Species2"],["media/1558580116374.jpg","media/1558580178316.jpg","media/1558580622081.jpg","media/1558580706298.jpg"],[-31.9961627,-31.9963167,-31.99617267,-31.99615233],[115.8841655,115.8843675,115.88431406,115.884342],[0,0,-13,-8],[56.1,40.519,5.36,4.288],["shrub","tree","shrub","shrub"],[9311960202528,9311960202528,9311960202528,9311960202528],["uuid:c0f9ce58-4388-4e7b-98d7-feac459d2e12","uuid:c0f9ce58-4388-4e7b-98d7-feac459d2e12","uuid:e0375332-0bb5-4175-a498-549bb33420e4","uuid:e0375332-0bb5-4175-a498-549bb33420e4"],["uuid:c0f9ce58-4388-4e7b-98d7-feac459d2e12/taxon_encounter[1]","uuid:c0f9ce58-4388-4e7b-98d7-feac459d2e12/taxon_encounter[2]","uuid:e0375332-0bb5-4175-a498-549bb33420e4/taxon_encounter[1]","uuid:e0375332-0bb5-4175-a498-549bb33420e4/taxon_encounter[2]"],["2019-05-23T03:12:16Z","2019-05-23T03:12:16Z","2019-05-23T03:07:34Z","2019-05-23T03:07:34Z"],["2019-05-23T02:46:04Z","2019-05-23T02:46:04Z","2019-05-23T02:58:34Z","2019-05-23T02:58:34Z"],["Florian Mayer","Florian Mayer","Florian Mayer","Florian Mayer"],["ccb596b33cd13298","ccb596b33cd13298","351848090572014","351848090572014"],["Kens1","Kens1","Kens02","Kens02"],["media/1558579592153.jpg","media/1558579592153.jpg","media/1558580334821.jpg","media/1558580334821.jpg"],[-31.9961844,-31.9961844,-31.99620765,-31.99620765],[115.8840312,115.8840312,115.88430933,115.88430933],[0,0,-21,-21],[41.909,41.909,12.864,12.864],["open-depression","open-depression","flat","flat"],["media/1558579731266.jpg","media/1558579731266.jpg","media/1558580394989.jpg","media/1558580394989.jpg"],["Lanscaped native shrubs over red gravel","Lanscaped native shrubs over red gravel","Planter box over concrete pavers","Planter box over concrete pavers"],[-31.9961229,-31.9961229,-31.99620102,-31.99620102],[115.883982,115.883982,115.88428661,115.88428661],[0,0,-22,-22],[40.977,40.977,12.864,12.864],[-31.9966621,-31.9966621,-31.99619855,-31.99619855],[115.884307,115.884307,115.88427853,115.88427853],[0,0,-22,-22],[60,60,15.008,15.008],[-31.9961278,-31.9961278,-31.99617953,-31.99617953],[115.8840645,115.8840645,115.88427163,115.88427163],[0,0,-26,-26],[72.9,72.9,9.648001,9.648001],["media/1558580082333.jpg","media/1558580082333.jpg","media/1558580571494.jpg","media/1558580571494.jpg"],["2019-05-23T02:57:17Z","2019-05-23T02:57:17Z","2019-05-23T03:05:48Z","2019-05-23T03:05:48Z"],["uuid:c0f9ce58-4388-4e7b-98d7-feac459d2e12","uuid:c0f9ce58-4388-4e7b-98d7-feac459d2e12","uuid:e0375332-0bb5-4175-a498-549bb33420e4","uuid:e0375332-0bb5-4175-a498-549bb33420e4"],[228,228,228,228],["manjimup","manjimup","manjimup","manjimup"],[null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>canonical_name<\/th>\n      <th>photo_in_situ<\/th>\n      <th>taxon_encounter_location_Latitude<\/th>\n      <th>taxon_encounter_location_Longitude<\/th>\n      <th>taxon_encounter_location_Altitude<\/th>\n      <th>taxon_encounter_location_Accuracy<\/th>\n      <th>life_form<\/th>\n      <th>voucher_specimen_barcode<\/th>\n      <th>PARENT_KEY<\/th>\n      <th>KEY.x<\/th>\n      <th>SubmissionDate<\/th>\n      <th>encounter_start_datetime<\/th>\n      <th>reporter<\/th>\n      <th>device_id<\/th>\n      <th>location_area_name<\/th>\n      <th>location_quadrat_photo<\/th>\n      <th>location_corner1_Latitude<\/th>\n      <th>location_corner1_Longitude<\/th>\n      <th>location_corner1_Altitude<\/th>\n      <th>location_corner1_Accuracy<\/th>\n      <th>habitat_morphological_type<\/th>\n      <th>habitat_morphological_type_photo<\/th>\n      <th>vegetation_structure_vegclass_placeholder<\/th>\n      <th>perimeter_corner2_Latitude<\/th>\n      <th>perimeter_corner2_Longitude<\/th>\n      <th>perimeter_corner2_Altitude<\/th>\n      <th>perimeter_corner2_Accuracy<\/th>\n      <th>perimeter_corner3_Latitude<\/th>\n      <th>perimeter_corner3_Longitude<\/th>\n      <th>perimeter_corner3_Altitude<\/th>\n      <th>perimeter_corner3_Accuracy<\/th>\n      <th>perimeter_corner4_Latitude<\/th>\n      <th>perimeter_corner4_Longitude<\/th>\n      <th>perimeter_corner4_Altitude<\/th>\n      <th>perimeter_corner4_Accuracy<\/th>\n      <th>perimeter_mudmap_photo<\/th>\n      <th>encounter_end_datetime<\/th>\n      <th>KEY.y<\/th>\n      <th>SubmitterID<\/th>\n      <th>SubmitterName<\/th>\n      <th>Status<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[3,4,5,6,8,17,18,19,20,24,25,26,27,28,29,30,31,32,33,34,35,39]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co"># Further: create map with popups, see vignette "odata"</span></a></code></pre></div>
<p>In future versions of <code>ruODK</code>, we’ll introspect the form schema to determine the names of repeating groups, the form field names of attachments (data type “binary” in form schema), and thus could automate the process shown above.</p>
</div>
<div id="list-submissions-for-one-form" class="section level2">
<h2 class="hasAnchor">
<a href="#list-submissions-for-one-form" class="anchor"></a>List submissions for one form</h2>
<p>Not always is it appropriate to download all submissions and all attachments at once.</p>
<p>If forms feed into downstream data warehouses, the typical ETL workflow is to</p>
<ul>
<li>List all submissions from ODK Central</li>
<li>Select the subset of new submissions to download, e.g.
<ul>
<li>Submissions younger than the oldest submission date in the data warehouse.</li>
<li>Submissions whose <code>instance_id</code> is not already present in the data warehouse.</li>
</ul>
</li>
<li>Download only the selected submissions.</li>
<li>Download attachments of only the selected submissions.</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">sl &lt;-<span class="st"> </span>ruODK<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ruODK/man/submission_list.html">submission_list</a></span>(</a>
<a class="sourceLine" id="cb12-2" title="2">  <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_PID"</span>),</a>
<a class="sourceLine" id="cb12-3" title="3">  <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_FID"</span>),</a>
<a class="sourceLine" id="cb12-4" title="4">  <span class="dt">url =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_URL"</span>),</a>
<a class="sourceLine" id="cb12-5" title="5">  <span class="dt">un =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_UN"</span>),</a>
<a class="sourceLine" id="cb12-6" title="6">  <span class="dt">pw =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_PW"</span>)</a>
<a class="sourceLine" id="cb12-7" title="7">)</a>
<a class="sourceLine" id="cb12-8" title="8">sl <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(.)</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">instance_id</th>
<th align="right">submitter_id</th>
<th align="left">device_id</th>
<th align="left">created_at</th>
<th align="left">updated_at</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">uuid:c0f9ce58-4388-4e7b-98d7-feac459d2e12</td>
<td align="right">228</td>
<td align="left">android_id:ccb596b33cd13298</td>
<td align="left">2019-05-23 03:12:16</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">uuid:e0375332-0bb5-4175-a498-549bb33420e4</td>
<td align="right">228</td>
<td align="left">imei:351848090572014</td>
<td align="left">2019-05-23 03:07:34</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>The list of submissions critically contains each submission’s unique ID in <code>instance_id</code>. If the submissions shall be downloaded and uploaded into another data warehouse, the <code>instance_id</code> can be used to determine whether a record already exists in the downstream warehouse or not. This workflow is preferable where the majority of submissions is already imported into another downstream data warehouse, and we only want to add new submissions, as in submissions which are not already imported into the data warehouse.</p>
<p>Furthermore, the <code>instance_id</code>s can now be used to retrieve the actual submissions.</p>
</div>
<div id="get-submission-data" class="section level2">
<h2 class="hasAnchor">
<a href="#get-submission-data" class="anchor"></a>Get submission data</h2>
<p>In order to import each submission, we need to retrieve the data by <code>instance_id</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="co"># One submission</span></a>
<a class="sourceLine" id="cb13-2" title="2">sub &lt;-<span class="st"> </span>ruODK<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ruODK/man/submission_detail.html">submission_detail</a></span>(</a>
<a class="sourceLine" id="cb13-3" title="3">  <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_PID"</span>),</a>
<a class="sourceLine" id="cb13-4" title="4">  <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_FID"</span>),</a>
<a class="sourceLine" id="cb13-5" title="5">  sl<span class="op">$</span>instance_id[[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb13-6" title="6">  <span class="dt">url =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_URL"</span>),</a>
<a class="sourceLine" id="cb13-7" title="7">  <span class="dt">un =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_UN"</span>),</a>
<a class="sourceLine" id="cb13-8" title="8">  <span class="dt">pw =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_PW"</span>)</a>
<a class="sourceLine" id="cb13-9" title="9">)</a>
<a class="sourceLine" id="cb13-10" title="10"></a>
<a class="sourceLine" id="cb13-11" title="11"><span class="co"># Multiple submissions</span></a>
<a class="sourceLine" id="cb13-12" title="12">submissions &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span>(</a>
<a class="sourceLine" id="cb13-13" title="13">  <span class="dt">pid =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_PID"</span>),</a>
<a class="sourceLine" id="cb13-14" title="14">  <span class="dt">fid =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_FID"</span>),</a>
<a class="sourceLine" id="cb13-15" title="15">  <span class="dt">iid =</span> sl<span class="op">$</span>instance_id,  <span class="co"># this is a vector of multiple instance_ids</span></a>
<a class="sourceLine" id="cb13-16" title="16">  <span class="dt">url =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_URL"</span>),</a>
<a class="sourceLine" id="cb13-17" title="17">  <span class="dt">un =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_UN"</span>),</a>
<a class="sourceLine" id="cb13-18" title="18">  <span class="dt">pw =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_PW"</span>)</a>
<a class="sourceLine" id="cb13-19" title="19">) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-20" title="20"><span class="st">  </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map2.html">pmap</a></span>(ruODK<span class="op">::</span>submission_detail)</a></code></pre></div>
</div>
<div id="parse-submissions" class="section level2">
<h2 class="hasAnchor">
<a href="#parse-submissions" class="anchor"></a>Parse submissions</h2>
<p>The data in <code>sub</code> is one row of the bulk downloaded submissions in <code>data_quadrat</code>. The data in <code>submissions</code> represents all (or let’s pretend, the selected) submissions in <code>data_quadrat</code>. The field <code>xml</code> contains the actual submission data including repeating groups.</p>
<p>The structure is different to the output of <code><a href="../reference/odata_submission_get.html">ruODK::odata_submission_get</a></code>, therefore <code><a href="../reference/odata_submission_parse.html">ruODK::odata_submission_parse</a></code> does not work for those, as here we might have repeating groups included in a submission.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(submissions)</a>
<a class="sourceLine" id="cb14-2" title="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="co">#&gt; # A tibble: 1 x 5</span></a>
<a class="sourceLine" id="cb14-4" title="4"><span class="co">#&gt;   instance_id         submitter_id submitter created_at          updated_at</span></a>
<a class="sourceLine" id="cb14-5" title="5"><span class="co">#&gt;   &lt;chr&gt;                      &lt;int&gt; &lt;chr&gt;     &lt;dttm&gt;              &lt;lgl&gt;     </span></a>
<a class="sourceLine" id="cb14-6" title="6"><span class="co">#&gt; 1 uuid:c0f9ce58-4388…          228 manjimup  2019-05-23 03:12:16 NA        </span></a>
<a class="sourceLine" id="cb14-7" title="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb14-8" title="8"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb14-9" title="9"><span class="co">#&gt; # A tibble: 1 x 5</span></a>
<a class="sourceLine" id="cb14-10" title="10"><span class="co">#&gt;   instance_id         submitter_id submitter created_at          updated_at</span></a>
<a class="sourceLine" id="cb14-11" title="11"><span class="co">#&gt;   &lt;chr&gt;                      &lt;int&gt; &lt;chr&gt;     &lt;dttm&gt;              &lt;lgl&gt;     </span></a>
<a class="sourceLine" id="cb14-12" title="12"><span class="co">#&gt; 1 uuid:e0375332-0bb5…          228 manjimup  2019-05-23 03:07:34 NA</span></a></code></pre></div>
</div>
</div>
<div id="attachments" class="section level1">
<h1 class="hasAnchor">
<a href="#attachments" class="anchor"></a>Attachments</h1>
<div id="list-all-attachments-for-one-form" class="section level2">
<h2 class="hasAnchor">
<a href="#list-all-attachments-for-one-form" class="anchor"></a>List all attachments for one form</h2>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">al &lt;-<span class="st"> </span><span class="kw"><a href="../reference/attachment_list.html">attachment_list</a></span>(</a>
<a class="sourceLine" id="cb15-2" title="2">  <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_PID"</span>),</a>
<a class="sourceLine" id="cb15-3" title="3">  <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_FID"</span>),</a>
<a class="sourceLine" id="cb15-4" title="4">  sl<span class="op">$</span>instance_id[[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb15-5" title="5">  <span class="dt">url =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_URL"</span>),</a>
<a class="sourceLine" id="cb15-6" title="6">  <span class="dt">un =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_UN"</span>),</a>
<a class="sourceLine" id="cb15-7" title="7">  <span class="dt">pw =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_PW"</span>)</a>
<a class="sourceLine" id="cb15-8" title="8">)</a>
<a class="sourceLine" id="cb15-9" title="9">al</a>
<a class="sourceLine" id="cb15-10" title="10"><span class="co">#&gt; # A tibble: 5 x 2</span></a>
<a class="sourceLine" id="cb15-11" title="11"><span class="co">#&gt;   name              exists</span></a>
<a class="sourceLine" id="cb15-12" title="12"><span class="co">#&gt;   &lt;chr&gt;             &lt;lgl&gt; </span></a>
<a class="sourceLine" id="cb15-13" title="13"><span class="co">#&gt; 1 1558579592153.jpg TRUE  </span></a>
<a class="sourceLine" id="cb15-14" title="14"><span class="co">#&gt; 2 1558579731266.jpg TRUE  </span></a>
<a class="sourceLine" id="cb15-15" title="15"><span class="co">#&gt; 3 1558580082333.jpg TRUE  </span></a>
<a class="sourceLine" id="cb15-16" title="16"><span class="co">#&gt; 4 1558580116374.jpg TRUE  </span></a>
<a class="sourceLine" id="cb15-17" title="17"><span class="co">#&gt; 5 1558580178316.jpg TRUE</span></a>
<a class="sourceLine" id="cb15-18" title="18"></a>
<a class="sourceLine" id="cb15-19" title="19">attachments &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span>(</a>
<a class="sourceLine" id="cb15-20" title="20">  <span class="dt">pid =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_PID"</span>),</a>
<a class="sourceLine" id="cb15-21" title="21">  <span class="dt">fid =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_FID"</span>),</a>
<a class="sourceLine" id="cb15-22" title="22">  <span class="dt">iid =</span> sl<span class="op">$</span>instance_id,  <span class="co"># this is a vector of multiple instance_ids</span></a>
<a class="sourceLine" id="cb15-23" title="23">  <span class="dt">url =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_URL"</span>),</a>
<a class="sourceLine" id="cb15-24" title="24">  <span class="dt">un =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_UN"</span>),</a>
<a class="sourceLine" id="cb15-25" title="25">  <span class="dt">pw =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_PW"</span>)</a>
<a class="sourceLine" id="cb15-26" title="26">) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-27" title="27"><span class="st">  </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map2.html">pmap</a></span>(ruODK<span class="op">::</span>attachment_list)</a>
<a class="sourceLine" id="cb15-28" title="28">attachments</a>
<a class="sourceLine" id="cb15-29" title="29"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb15-30" title="30"><span class="co">#&gt; # A tibble: 5 x 2</span></a>
<a class="sourceLine" id="cb15-31" title="31"><span class="co">#&gt;   name              exists</span></a>
<a class="sourceLine" id="cb15-32" title="32"><span class="co">#&gt;   &lt;chr&gt;             &lt;lgl&gt; </span></a>
<a class="sourceLine" id="cb15-33" title="33"><span class="co">#&gt; 1 1558579592153.jpg TRUE  </span></a>
<a class="sourceLine" id="cb15-34" title="34"><span class="co">#&gt; 2 1558579731266.jpg TRUE  </span></a>
<a class="sourceLine" id="cb15-35" title="35"><span class="co">#&gt; 3 1558580082333.jpg TRUE  </span></a>
<a class="sourceLine" id="cb15-36" title="36"><span class="co">#&gt; 4 1558580116374.jpg TRUE  </span></a>
<a class="sourceLine" id="cb15-37" title="37"><span class="co">#&gt; 5 1558580178316.jpg TRUE  </span></a>
<a class="sourceLine" id="cb15-38" title="38"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb15-39" title="39"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb15-40" title="40"><span class="co">#&gt; # A tibble: 5 x 2</span></a>
<a class="sourceLine" id="cb15-41" title="41"><span class="co">#&gt;   name              exists</span></a>
<a class="sourceLine" id="cb15-42" title="42"><span class="co">#&gt;   &lt;chr&gt;             &lt;lgl&gt; </span></a>
<a class="sourceLine" id="cb15-43" title="43"><span class="co">#&gt; 1 1558580334821.jpg TRUE  </span></a>
<a class="sourceLine" id="cb15-44" title="44"><span class="co">#&gt; 2 1558580394989.jpg TRUE  </span></a>
<a class="sourceLine" id="cb15-45" title="45"><span class="co">#&gt; 3 1558580571494.jpg TRUE  </span></a>
<a class="sourceLine" id="cb15-46" title="46"><span class="co">#&gt; 4 1558580622081.jpg TRUE  </span></a>
<a class="sourceLine" id="cb15-47" title="47"><span class="co">#&gt; 5 1558580706298.jpg TRUE</span></a></code></pre></div>
</div>
<div id="get-attachments" class="section level2">
<h2 class="hasAnchor">
<a href="#get-attachments" class="anchor"></a>Get attachments</h2>
<p>While we’re working on parsing the submissions into something resembling <code>data_quadrat</code>, we’ll demonstrate the use of <code><a href="../reference/attachment_get.html">ruODK::attachment_get</a></code> using <code>data_quadrat_raw</code>, which still contains the plain filenames without prefixed local folders.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">data_quadrat_att &lt;-<span class="st"> </span>data_quadrat_raw <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(</a>
<a class="sourceLine" id="cb16-3" title="3">    <span class="dt">location_quadrat_photo =</span> ruODK<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ruODK/man/attachment_get.html">attachment_get</a></span>(</a>
<a class="sourceLine" id="cb16-4" title="4">        <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_PID"</span>),</a>
<a class="sourceLine" id="cb16-5" title="5">        <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_FID"</span>),</a>
<a class="sourceLine" id="cb16-6" title="6">        meta_instanceID,</a>
<a class="sourceLine" id="cb16-7" title="7">        location_quadrat_photo,</a>
<a class="sourceLine" id="cb16-8" title="8">        <span class="dt">local_dir =</span> t,</a>
<a class="sourceLine" id="cb16-9" title="9">        <span class="dt">url =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_URL"</span>),</a>
<a class="sourceLine" id="cb16-10" title="10">        <span class="dt">un =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_UN"</span>),</a>
<a class="sourceLine" id="cb16-11" title="11">        <span class="dt">pw =</span> <span class="kw"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span>(<span class="st">"ODKC_TEST_PW"</span>)</a>
<a class="sourceLine" id="cb16-12" title="12">    )</a>
<a class="sourceLine" id="cb16-13" title="13">    <span class="co"># same for all other attachments</span></a>
<a class="sourceLine" id="cb16-14" title="14">    <span class="co"># requires knowledge or introspection of form schema</span></a>
<a class="sourceLine" id="cb16-15" title="15">  )</a>
<a class="sourceLine" id="cb16-16" title="16"></a>
<a class="sourceLine" id="cb16-17" title="17"><span class="co"># We have file paths...</span></a>
<a class="sourceLine" id="cb16-18" title="18">data_quadrat_att<span class="op">$</span>location_quadrat_photo</a>
<a class="sourceLine" id="cb16-19" title="19"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb16-20" title="20"><span class="co">#&gt; [1] "api/c0f9ce58-4388-4e7b-98d7-feac459d2e12/1558579592153.jpg"</span></a>
<a class="sourceLine" id="cb16-21" title="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-22" title="22"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb16-23" title="23"><span class="co">#&gt; [1] "api/e0375332-0bb5-4175-a498-549bb33420e4/1558580334821.jpg"</span></a>
<a class="sourceLine" id="cb16-24" title="24"></a>
<a class="sourceLine" id="cb16-25" title="25"><span class="co"># ...and the corresponding files</span></a>
<a class="sourceLine" id="cb16-26" title="26">fs<span class="op">::</span><span class="kw"><a href="http://fs.r-lib.org/reference/dir_ls.html">dir_ls</a></span>(t, <span class="dt">recurse =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb16-27" title="27"><span class="co">#&gt; api/build_Flora-Quadrat-0-2_1558575936-taxon_encounter.csv</span></a>
<a class="sourceLine" id="cb16-28" title="28"><span class="co">#&gt; api/build_Flora-Quadrat-0-2_1558575936.csv</span></a>
<a class="sourceLine" id="cb16-29" title="29"><span class="co">#&gt; api/build_Flora-Quadrat-0-2_1558575936.zip</span></a>
<a class="sourceLine" id="cb16-30" title="30"><span class="co">#&gt; api/c0f9ce58-4388-4e7b-98d7-feac459d2e12</span></a>
<a class="sourceLine" id="cb16-31" title="31"><span class="co">#&gt; api/c0f9ce58-4388-4e7b-98d7-feac459d2e12/1558579592153.jpg</span></a>
<a class="sourceLine" id="cb16-32" title="32"><span class="co">#&gt; api/e0375332-0bb5-4175-a498-549bb33420e4</span></a>
<a class="sourceLine" id="cb16-33" title="33"><span class="co">#&gt; api/e0375332-0bb5-4175-a498-549bb33420e4/1558580334821.jpg</span></a>
<a class="sourceLine" id="cb16-34" title="34"><span class="co">#&gt; api/media</span></a>
<a class="sourceLine" id="cb16-35" title="35"><span class="co">#&gt; api/media/1558579592153.jpg</span></a>
<a class="sourceLine" id="cb16-36" title="36"><span class="co">#&gt; api/media/1558579731266.jpg</span></a>
<a class="sourceLine" id="cb16-37" title="37"><span class="co">#&gt; api/media/1558580082333.jpg</span></a>
<a class="sourceLine" id="cb16-38" title="38"><span class="co">#&gt; api/media/1558580116374.jpg</span></a>
<a class="sourceLine" id="cb16-39" title="39"><span class="co">#&gt; api/media/1558580178316.jpg</span></a>
<a class="sourceLine" id="cb16-40" title="40"><span class="co">#&gt; api/media/1558580334821.jpg</span></a>
<a class="sourceLine" id="cb16-41" title="41"><span class="co">#&gt; api/media/1558580394989.jpg</span></a>
<a class="sourceLine" id="cb16-42" title="42"><span class="co">#&gt; api/media/1558580571494.jpg</span></a>
<a class="sourceLine" id="cb16-43" title="43"><span class="co">#&gt; api/media/1558580622081.jpg</span></a>
<a class="sourceLine" id="cb16-44" title="44"><span class="co">#&gt; api/media/1558580706298.jpg</span></a></code></pre></div>
<p>From here, we can use the separately created data tibbles and locally downloaded attachments to build visualisations as shown in the vignette “odata”.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#scope">Scope</a><ul class="nav nav-pills nav-stacked">
<li><a href="#three-ways-to-happiness">Three ways to happiness</a></li>
      </ul>
</li>
      <li><a href="#setup-ruodk">Setup ruODK</a></li>
      <li><a href="#projects">Projects</a></li>
      <li>
<a href="#forms">Forms</a><ul class="nav nav-pills nav-stacked">
<li><a href="#list-forms-for-a-project">List forms for a project</a></li>
      <li><a href="#show-details-of-one-form">Show details of one form</a></li>
      <li><a href="#inspect-form-schema">Inspect form schema</a></li>
      </ul>
</li>
      <li>
<a href="#submissions">Submissions</a><ul class="nav nav-pills nav-stacked">
<li><a href="#get-all-submissions-for-one-form">Get all submissions for one form</a></li>
      <li><a href="#list-submissions-for-one-form">List submissions for one form</a></li>
      <li><a href="#get-submission-data">Get submission data</a></li>
      <li><a href="#parse-submissions">Parse submissions</a></li>
      </ul>
</li>
      <li>
<a href="#attachments">Attachments</a><ul class="nav nav-pills nav-stacked">
<li><a href="#list-all-attachments-for-one-form">List all attachments for one form</a></li>
      <li><a href="#get-attachments">Get attachments</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Florian W. Mayer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9100.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
