% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/submission_export.R
\name{submission_export}
\alias{submission_export}
\title{Export all form submissions to CSV.}
\usage{
submission_export(pid, fid, local_dir = here::here(), overwrite = TRUE,
  url = Sys.getenv("ODKC_URL"), un = Sys.getenv("ODKC_UN"),
  pw = Sys.getenv("ODKC_PW"), verbose = FALSE)
}
\arguments{
\item{pid}{The numeric ID of the project, e.g.: 2.}

\item{fid}{The alphanumeric form ID, e.g. "build_Spotlighting-0-8_1559885147".}

\item{local_dir}{The local folder to save the downloaded files to,
default: `here::here()`.}

\item{overwrite}{Whether to overwrite previously downloaded zip files,
default: FALSE}

\item{url}{The OData URL, ending in .svc, no trailing slash.}

\item{un}{The ODK Central username (an email address),
default: Sys.getenv("ODKC_UN").
Add to your ~/.Rprofile: Sys.setenv(ODKC_UN="...@...")}

\item{pw}{The ODK Central password,,
default: Sys.getenv("ODKC_PW").
Add to your ~/.Rprofile: Sys.setenv(ODKC_PW="...")}

\item{verbose}{Whether to display debug messages or not (default)}
}
\value{
The absolute path to the zip file named "`fid`.zip"
        containing submissions as CSV,
        plus separate CSVs for any repeating groups,
        plus any attachments in a subfolder `media`.
}
\description{
To export all the Submission data associated with a Form, just add .csv.zip
to the end of the listing URL. The response will be a zip file containing one
or more CSV files, as well as all multimedia attachments associated with the
included Submissions.
}
\details{
The file will be downloaded to the project root unless specified otherwise
(via `local_dir`). Subsequently, the zip file can be extracted.
Attachment filenames (e.g. "12345.jpg") should be prepended with `media`
(resulting in e.g. `media\12345.jpg`) in order to represent the relative
path to the actual attachment file (as extracted from the zip file).

This function downloads all submissions and attachments in one go.
For incremental download of a subset of submissions, use `submission_list`,
choose the submissions of interest (e.g. by submission date), and use their
uuids to download them one by one via `submission_get`. Download attachments
as listed for each submission (`attachment_list`).
}
\examples{
\dontrun{
# With default credentials, see vignette("setup")
se <- submission_export(1, "build_xformsId")

# With explicit credentials, see tests

t <- tempdir()

se <- submission_export(
  Sys.getenv("ODKC_TEST_PID"),
  Sys.getenv("ODKC_TEST_FID"),
  local_dir = t,
  overwrite = FALSE,
  verbose = TRUE,
  url = Sys.getenv("ODKC_TEST_URL"),
  un = Sys.getenv("ODKC_TEST_UN"),
  pw = Sys.getenv("ODKC_TEST_PW")
)

# Unzip and inspect the loot

t <- tempdir()
f <- unzip(se, exdir = t)
fs::dir_ls(t)
fid <- Sys.getenv("ODKC_TEST_FID")
sub <- fs::path(t, glue::glue("{fid}.csv")) \%>\% readr::read_csv()
sub \%>\% knitr::kable(.)
# Cleanup
fs::dir_delete(t)
}
}
\seealso{
\url{https://odkcentral.docs.apiary.io/#reference/forms-and-submissions/submissions/exporting-form-submissions-to-csv}

Other restful-api: \code{\link{attachment_list}},
  \code{\link{form_detail}}, \code{\link{form_list}},
  \code{\link{form_schema}}, \code{\link{form_xml}},
  \code{\link{project_detail}}, \code{\link{project_list}},
  \code{\link{submission_detail}},
  \code{\link{submission_list}}
}
\concept{restful-api}
